---
layout: default
---

{{ content }}

<p class="visuallyhidden">
  The following form filters and update content in the table below.
</p>

<form class="tag-filter" id="tag-filter">
  <div class="form-group">
    <label for="tagSelect">Tags</label>
    <select name="tagSelect" id="tagSelect" placeholder="Select tags" multiple>
    </select>
  </div>

  <div class="form-group">
    <label for="search" class="visuallyhidden">Search</label>
    <button class="submit-btn" id="submit-btn" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
    <input name="search" type="search" id="search" placeholder="Search" class="input-search" />
  </div>
</form>

<div class="materials-panel">

  <table class="materials" id="materialsList">
    <tbody>
      {% for material in site.materials %}
      <tr class="material visible">
        <td>
          <div class="material__details">

            <ul class="authors">
              {% for item in material.authors %}
              <li>{{ item.family-names }}</li>
              {% endfor %}
            </ul>

            <h2 class="title"><a href="{{ material.url }}">

                {% assign github_parts = material.github_repo_url | split: "/" | reverse %}
                {% assign github_repo = github_parts[0] %}

                {% if material.name %}
                {{ material.name }}
                {% elsif material.title %}
                {{ material.title }}
                {% elsif material.remark-name %}
                {{ material.remark-name }}
                {% elsif material.title-original-paper %}
                {{ material.title-original-paper }}
                {% else %}
                {{ github_repo }}
                {% endif %}

              </a></h2>

              <p class="summary">{{ material.abstract | truncatewords: 30 }}</p>

            <ul class="tags">
              {% for tag in material.tags %}
              <li>{{ tag }}</li>
              {% endfor %}
            </ul>

          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  const table_rows = document.querySelectorAll("tr.material")
  const form = document.querySelector("form")
  const tags = [...document.querySelectorAll("ul.tags li")].map((v) => { return v.innerText });

  const tagSelect = document.getElementById('tagSelect');

  form.addEventListener("change", (e) => {
    let evt = document.createEvent("Event");
    evt.initEvent("submit", true, true);
    form.dispatchEvent(evt)
  });

  function isSuperset(set, subset) {
    for (const elem of subset) {
      if (!set.has(elem)) {
        return false;
      }
    }
    return true;
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault()
    const formData = new FormData(form);

    table_rows.forEach(function (row) {
      const row_tags = new Set([...row.querySelectorAll("ul.tags li")].map((v) => { return v.innerText }));
      const row_title = row.querySelector("h2.title").innerText;
      const row_authors = [...row.querySelectorAll("ul.authors li")]
      const row_abstract = row.querySelector("p.summary").innerText;

      //console.log(row_authors);

      const tag_matches = isSuperset(row_tags, formData.getAll("tagSelect"));
      const title_matches = row_title.toLowerCase().includes(formData.get("search").toLowerCase());
      const author_matches = row_authors.some((li) => {
        return li.innerText.toLowerCase().includes(formData.get("search").toLowerCase())
      });

      console.log(author_matches);

      const abstract_matches = row_abstract.toLowerCase().includes(formData.get("search").toLowerCase());
      //console.log(title_matches, author_matches, abstract_matches);
      if (tag_matches && (title_matches || author_matches || abstract_matches)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
    document.documentElement.scrollTop = 0;
    return false;
  });

  function insertTextAndSubmit(event) {
    var textValue = event.target.textContent;
    document.getElementById('search').value = textValue;
    document.getElementById('submit-btn').click();
  }

  var listItems = document.querySelectorAll('.authors li');
  listItems.forEach(function(li) {
    li.addEventListener('click', insertTextAndSubmit);
  });

  document.addEventListener("DOMContentLoaded", () => {
    const choices = new Choices(tagSelect, {
      allowHTML: true,
      choices: [...new Set(tags)].map((v) => { return { 'value': v } }),
      delimiter: ',',
      editItems: true,
      maxItemCount: 5,
      removeItemButton: true,
    });

    function addTagToFilter(event) {
      var textValue = event.target.textContent;
      choices.setChoiceByValue(textValue);
      let evt = document.createEvent("Event");
      evt.initEvent("change", true, true);
      tagSelect.dispatchEvent(evt)
    }

    var tagPills = document.querySelectorAll('.tags li');
    tagPills.forEach(function(li) {
      li.addEventListener('click', addTagToFilter);
    });

  });

</script>